<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– ä¸­è’™ä»£è´­æœºå™¨äººç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
        }
        .status { 
            background: #48bb78; 
            padding: 10px 20px; 
            border-radius: 20px; 
            display: inline-block; 
            margin: 10px 0; 
        }
        .error { 
            background: #f56565; 
            padding: 10px 20px; 
            border-radius: 20px; 
            display: inline-block; 
            margin: 10px 0; 
        }
        .btn { 
            background: #4CAF50; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 50px; 
            cursor: pointer; 
            margin: 5px;
            font-size: 16px;
        }
        .btn-debug {
            background: #ed8936;
        }
        pre { 
            background: rgba(0,0,0,0.3); 
            color: #0f0; 
            padding: 20px; 
            border-radius: 10px; 
            overflow-x: auto; 
            margin: 20px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 40px;">
            <h1>ğŸ¤– ä¸­è’™ä»£è´­æœºå™¨äººç®¡ç†ç³»ç»Ÿ</h1>
            <div id="status" class="status">ğŸŸ¢ ç³»ç»Ÿåœ¨çº¿</div>
            <div id="error-info" class="error" style="display:none;"></div>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button class="btn" onclick="testBasic()">ğŸ”§ åŸºæœ¬APIæµ‹è¯•</button>
            <button class="btn" onclick="testWebhook()">ğŸ“¡ å®Œæ•´Webhookæµ‹è¯•</button>
            <button class="btn btn-debug" onclick="debug404()">ğŸ” è°ƒè¯•404é—®é¢˜</button>
            <button class="btn" onclick="checkTelegram()">ğŸ¤– æ£€æŸ¥TelegramçŠ¶æ€</button>
            <button class="btn" onclick="setWebhook()">ğŸ”„ è®¾ç½®Webhook</button>
        </div>
        
        <h3>ğŸ“Š API çŠ¶æ€</h3>
        <div id="api-status" style="color: #ccc; margin: 10px 0;">ç­‰å¾…æµ‹è¯•...</div>
        
        <h3>ğŸ“ æµ‹è¯•ç»“æœ</h3>
        <pre id="result">æš‚æ— ç»“æœ</pre>
        
        <h3>ğŸ“‹ å¾…åŠäº‹é¡¹</h3>
        <ol>
            <li>âœ… ç¡®ä¿æœ‰æ­£ç¡®çš„æ–‡ä»¶ç»“æ„</li>
            <li>âœ… ç¡®ä¿å·²æ¨é€ä»£ç åˆ° GitHub</li>
            <li>âœ… ç¡®ä¿ Vercel å·²è‡ªåŠ¨éƒ¨ç½²</li>
            <li>âœ… æµ‹è¯• API ç«¯ç‚¹æ˜¯å¦å¯è®¿é—®</li>
            <li>âœ… è®¾ç½® Telegram Webhook URL</li>
        </ol>
    </div>

    <script>
        function showResult(message, type = 'success') {
            const pre = document.getElementById('result');
            pre.textContent = typeof message === 'string' ? message : JSON.stringify(message, null, 2);
        }
        
        async function testBasic() {
            try {
                showResult('ğŸ”„ æµ‹è¯•åŸºç¡€ API è¿æ¥...', 'info');
                const response = await fetch('/api/webhook');
                const text = await response.text();
                showResult(`âœ… API å“åº”:\nçŠ¶æ€: ${response.status}\nå†…å®¹: ${text}`);
            } catch (error) {
                showResult(`âŒ API è¿æ¥å¤±è´¥: ${error.message}`);
            }
        }
        
        async function testWebhook() {
            try {
                showResult('ğŸ”„ å‘é€æµ‹è¯• POST è¯·æ±‚...', 'info');
                const response = await fetch('/api/webhook', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        test: true,
                        message: 'è¿™æ˜¯æµ‹è¯•æ¶ˆæ¯',
                        timestamp: new Date().toISOString()
                    })
                });
                const data = await response.json();
                showResult(`âœ… POST æµ‹è¯•æˆåŠŸ:\nçŠ¶æ€: ${response.status}\nå“åº”:`, data);
            } catch (error) {
                showResult(`âŒ POST è¯·æ±‚å¤±è´¥: ${error.message}`);
            }
        }
        
        async function debug404() {
            try {
                showResult('ğŸ” è¯Šæ–­404é—®é¢˜...', 'info');
                
                // æµ‹è¯•å¤šä¸ªç«¯ç‚¹
                const endpoints = [
                    '/',
                    '/api/webhook',
                    '/api/test'
                ];
                
                let results = [];
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint);
                        results.push(`${endpoint}: ${response.status}`);
                    } catch (error) {
                        results.push(`${endpoint}: é”™è¯¯ - ${error.message}`);
                    }
                }
                
                showResult(`ğŸ” è¯Šæ–­ç»“æœ:\n${results.join('\n')}`);
                
            } catch (error) {
                showResult(`âŒ è¯Šæ–­å¤±è´¥: ${error.message}`);
            }
        }
        
        async function checkTelegram() {
            try {
                showResult('ğŸ¤– æ£€æŸ¥ Telegram Webhook çŠ¶æ€...', 'info');
                
                const token = '8383460965:AAG2unA8htPymlkTGK1kXqRmS61S5vDM34A';
                const response = await fetch(`https://api.telegram.org/bot${token}/getWebhookInfo`);
                const data = await response.json();
                
                showResult('Telegram Webhook çŠ¶æ€:', data);
            } catch (error) {
                showResult(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
        }
        
        async function setWebhook() {
            try {
                showResult('ğŸ”„ è®¾ç½® Telegram Webhook...', 'info');
                
                const token = '8383460965:AAG2unA8htPymlkTGK1kXqRmS61S5vDM34A';
                const webhookUrl = 'https://zhongmeng-daqui-bot.vercel.app/api/webhook';
                
                // å…ˆåˆ é™¤æ—§çš„
                await fetch(`https://api.telegram.org/bot${token}/deleteWebhook`);
                
                // è®¾ç½®æ–°çš„
                const response = await fetch(`https://api.telegram.org/bot${token}/setWebhook?url=${encodeURIComponent(webhookUrl)}`);
                const data = await response.json();
                
                showResult('Webhook è®¾ç½®ç»“æœ:', data);
            } catch (error) {
                showResult(`âŒ è®¾ç½®å¤±è´¥: ${error.message}`);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                testBasic();
            }, 1000);
        });
    </script>
</body>
</html>
